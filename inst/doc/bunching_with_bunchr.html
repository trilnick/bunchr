<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Itai Trilnick" />

<meta name="date" content="2016-08-07" />

<title>Bunching estimation with bunchr</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Bunching estimation with <code>bunchr</code></h1>
<h4 class="author"><em>Itai Trilnick</em></h4>
<h4 class="date"><em>2016-08-07</em></h4>



<p>A growing literature in empirical economics is focused on bunching. Loosely speaking, bunching occurs when many people self select to a specific location in the range of some variable. When this happens, a histogram of this variable might show a visible “bunch” - a large mass that would not be otherwise predicted by the surrounding bins. This bunching behavior is then interpreted as the response to some economic reality. In words of someone smarter than me:</p>
<blockquote>
<p>“This approach uses bunching around points that feature discontinuities in incentives to elicit behavioral responses and estimate structural parameters.” <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
</blockquote>
<p>With the increasing use of administrative data, bunching has been used mostly by public and labor economists. Two main types of bunch-inducing setting are explored. First, where budget sets suddenly change slopes, creating a point where budget sets are continuous but non-differentiable. These “kinks” in budget sets have been explored in the case of Earned Income Tax Credits in the US<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> and income tax rates in Denmark<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>. The second type are notches, where a policy sets a discontinuity in the budget set. For example, bunching in earnings of individuals is observed in Pakistan, where the <em>average</em> tax rates, rather than the marginal ones, change when earnings cross thresholds<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a>. This creates a drop in the budget line of individuals, as <em>all</em> earnings are subject to a higher tax rate once earnings exceed the threshold.</p>
<p>When a policy introduces a kink or a notch, a structural analysis can be used to estimate a parameter of interest, such as the elasticity of earnings with respect to marginal tax rates. To do this, a specific function must be assumed for the agents. In many cases, a convenient function for analysis is quasi-linear and iso-elastic.</p>
<div id="what-can-you-do-with-bunchr" class="section level2">
<h2>What can you do with <code>bunchr</code>?</h2>
<p>The <code>bunchr</code> package can be used to visualize bunching, calculate counter-factual distributions, and estimate the compensated elasticity of earnings w.r.t. marginal tax rates, as usually done in the literature cited above. There is also a function to simulate earnings given certain parameters. <code>bunchr</code>’s language is of earnings and elasticities of earnings, but can be used for other suitable bunching analysis. Indeed, you can provide a title and x-axis label for the output plots.</p>
<p>Remember that, as usual, more observations are better. Bunching analysis involves the creation of a histogram, similar to a density curve. The narrower the bins of this histogram, the better. Wider bins could bias elasticity estimates. For a kink analysis, the elasticity formula takes into account the extra bunching over the width of the excluded area. Setting bins too wide could attenuate the estimates. For notches, the procedure involves finding the “end” of the notch, where the discontinuity in incentives is no longer relevant. This limit, referred to as <em>delta_zed</em> in the code, is determined in number of bins after the bunching bin. Setting bins too wide limits the set of potential <em>delta_zed</em>, which might bias the estimates.</p>
<p>Having more observations, one can use narrower bins and still avoid a “jumpy” looking histogram. It is better to have a smoother looking histogram, as the counter-factual histogram for the area of kink or notch is made by interpolation from the area outside of the notch. Smoother histograms make more reliable counter-factuals. As a robustness check for any analysis, I recommend comparing the results of analysis with varying bin widths.</p>
</div>
<div id="pre-analysis-viewing-a-distribution" class="section level2">
<h2>Pre-analysis: Viewing a distribution</h2>
<p>All you need is a vector of earnings. Using <code>bunch_viewer</code>, you can see how a histogram of your data looks like. Additionally, you can see where you could potentially set some of the parameters for analysis. And, you can save the histogram as an <em>R</em> histogram object.</p>
<p>Let’s create an earning distribution for a kinked budget set. First, I create a vector of latent abilities, with 100,000 values. Then, I simulate the earnings for a situation where everyone’s elasticity of earnings w.r.t. marginal tax rate is 0.2 (<em>elas</em> = 0.2). The simulationincludes a kink at the earning point of 1000 (<em>zstar</em> = 1000), where the marginal tax rate increases from 0% to 10% (<em>t1</em> = 0, <em>t2</em> = 0.1), the notch height is zero (<em>Tax</em> = 0). After creating the earning vector, we can view it with <code>bunch_viewer</code>.</p>
<p>As a preparation for further analysis, I can specify where the counter-factual distribution will be calculated (setting <em>cf_start</em> and <em>cf_end</em>), and where the bunching seems to be (<em>exclude_before</em> and <em>exclude_after</em>) relative to the place of the notch. Note that these are stated in number of bins. The wider the bins, the greater the distances from the kink! That’s where <code>bunch_viewer</code> comes handy.</p>
<p>In this case, one can observe the whole bunching bin and the rest of the distribution quite well. In other cases, specially notches (where bunching is more substantial), the height of the bunching bin can be so high that, in order to include it in the graph, the rest of the distribution can hardly be seen. In these cases, I would keep the default option of “trimming” the vertical axis by keeping the default options and not specifying <em>trimy</em> = F. Also note that you can personalize the plot’s title and x-axis label.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">42</span>)
ability_vec &lt;-<span class="st"> </span><span class="dv">4000</span> *<span class="st"> </span><span class="kw">rbeta</span>(<span class="dv">100000</span>, <span class="dv">2</span>, <span class="dv">5</span>)
earning_vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(ability_vec, earning_fun, <span class="fl">0.2</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="dv">1000</span>)
<span class="kw">bunch_viewer</span>(earning_vec, <span class="dv">1000</span>, <span class="dt">cf_start =</span> <span class="dv">10</span>, <span class="dt">cf_end =</span> <span class="dv">10</span>, <span class="dt">exclude_before =</span> <span class="dv">2</span>,
             <span class="dt">exclude_after =</span> <span class="dv">2</span>, <span class="dt">binw =</span> <span class="dv">50</span>, <span class="dt">trimy=</span>F)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="analyzing-a-kink" class="section level2">
<h2>Analyzing a kink</h2>
<p>We viewed the distribution. Now we want to get an estimate for the elasticity of earnings. We can use the same specification as we did while viewing. Note that, in order to calculate the elasticity, we must provide the marginal tax rates!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kink_est &lt;-<span class="st"> </span><span class="kw">bunch</span>(earning_vec, <span class="dt">zstar =</span> <span class="dv">1000</span>, <span class="dt">t1 =</span> <span class="dv">0</span>, <span class="dt">t2 =</span> <span class="fl">0.1</span>, <span class="dt">Tax =</span> <span class="dv">0</span>,
                   <span class="dt">cf_start =</span> <span class="dv">10</span>, <span class="dt">cf_end =</span> <span class="dv">10</span>,
                   <span class="dt">exclude_before =</span> <span class="dv">2</span>, <span class="dt">exclude_after =</span> <span class="dv">2</span>, <span class="dt">binw =</span> <span class="dv">50</span>, <span class="dt">nboots =</span> <span class="dv">100</span>)</code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqAAAAGACAMAAABFpiBcAAAAh1BMVEUAAAAAADoAAGYAOpAAZrYAiwAA/wA6AAA6ADo6AGY6OgA6OpA6kNtmAABmADpmAGZmZmZmkJBmtrZmtv+QOgCQOjqQkGaQ29uQ2/+gIPC2ZgC2Zma2tma225C2/7a2/9u2///bkDrb2//b/7bb/9vb////AAD/tmb/trb/25D//7b//9v///+Nfw/5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAXFElEQVR4nO2dC5ubuBWGPRmns9vi7G48TSd0N427O6Hj4f//vqIrEhchgZAO8L3PE48NGMvyG10OSDrVABDmlDsBALiAoIA0EBSQBoIC0kBQQBoICkgDQQFpICggDQQFpIGggDQQFJAGggLSQFBAGggKSANBAWkgKCANBAWkgaCANBAUkAaCAtJAUEAaCApIA0EBaSAoIA0EBaSBoIA0EBSQBoIC0kBQQBoICkgDQQFpICggzXEFvZ0kj6++b3h4kU/fnyfe1RwgD357Oj3+NXW4cVbnqf/9ffqjdwYEPZ0+fPd8g7+g7OyFfuIp1ZSg98sHCHocWkGlStNv0IJOc79Ij0pf/6e1DzjVfjiyoOLnburgs/rxG60KYWJ5UjpWTOFrbW0WKtnH8WetQ6XY3pzxrMy76QaF+WksAcZZ+UOzh8O26t0lL+3/Iy3mm4u67iZ3b0DQ5pcuuoK2eggtTuZmXc+axzVb2LO/a0EroU/F5LYOZweYn1bpk/QFbd7V7rYEvbXtZyu5u+PIgpq9pI6gzQvRiuSeNZvFBqFZ0RpnHsfLYS2orONL7TMvS6W3xqc1+87yf0mnDVpKac/WfyKxn3W9ZFqsZOwPCCrq746gV7vqv/EHvllZJfy49poIupnIt4gT8sOb4+x9qoqXaTl3BBXKG7tNQWVTopRq6mTsDwh66pZpsjdkth7lGzqbB44z+jG8cq+sxqXukJmfJrd3BVWut7sNQdVBPAVGMnbIkQUVLgkThDKiKrXFO7dvGBdU6WEIyjeVXCRxuGpYXmvz07iA1/asrXu8ZDd295oL8j8BBN0nSlDxA48LOrcEZc+/iUpcn0X1441PEx/ZE1TV2MZulKDHQgkqLvqIX7k6dQSVKlVsg0vQgTYoc+tXXU03h7//U0QFeLNRf1qlWpBWJ6l5FCcydo+3QSHoHjHaoEbnvCtoJRuHdlXaF7TXi5e181k+450kYZ79aXwze2qVoLKCr83d4vOGevEQdI+0gupwuA54Gr94qfsoTkF7cVD5CVwzKw7a+TTVCbIE1fvPxm4eEu3EQc81BN0rWlAdrz89/tntxdcykF7UE4LK0tO6GqkDS227cuDTmIIPL6zB0QpanUxr5W5xsepf5pWka11DUBBAeaw7ORIAQeNQ8lJ2r9HyjEDQOKhKeZ8XxDMCQSMhwvCo4GMDQQFpICggDQQFpIGggDQQFJAGggLSQFBAGggKSANBAWkgKCANBAWkgaCANBAUkAaCAtJAUEAaCApIA0EBaSAoIA0EBaSBoIA0EBSQBoIC0kBQQBoICkgDQQFpICggDQQFpDmMoCfjcc+cNoL391kzsyhxGEFzJ8APCNoFgpICgnaBoKSAoF0gKCkgaBcISgoI2gWCkgKCdoGgpJghqFoG4LpKghbx48eMN338aL0cELRzxIppSchOBW2XgdKrRBICgvqzT0Hvv5hO2q8IAEH92aegxIGg/mziB4WgNQSlzRxBm3bo42tZrJCapUBQf/YraPXwcnt8vV+KFZKzEAjqz24FfX8u6htbY5pcHx6ChrBIUL46PV/OsXQGHe+XpcHIcEHZZzJBKwgaPy0JWSJoxVZsrku2IG7pXHU0h6CqBHWnbLvgStIkb09cu/fnSQ1yCCrboDeKV5JiAEEnuUkp//e9V4LemtqeXckpRa3PBVXbmpefvrCrO3rn54toGzQbHr6w8pgdWsxLpt2L3/F65wcV9AfD8dfg/fncvrAFvTVasO5zeVbPr3pbzcxhR7c7mwf2pGykrU7yxdtT4Uim9/fZLwcVNAArgGMJqvbcP72IhkAjqHk0f27sLPgT0WJoWrTiULtzA0G7QNApbEHNTrxsnHIqtrER1Nymm6RqJ98kjGxajhWvls03QNA+EHSK8Sr+7SfZ8Gvakh/+ECWo3lYrQY2dfNNNCzoQsgq9WeTSjgclGGaKAQSdRHWSqkYlW9AnoySVVXyvBDV3DpWgM5O5iV8McVB/1ggzqcqfK1edBtqgV3tn3Sp8Y23QfmQIgkLQcHig/v25H6hn3fCmBSDKx+Yg1YuXrQJdguqd/MHqxYv4f3gy2wNVNe+q4vmlsPTNAAjqz6IShzsgLnUOxkFvLA5ZyjLRiIOqNmi7kz80Pa0PvzNXbj1nZgjaJOl27vS1OtxUtLXqhF1XBoL6Q61KHLl0PudafFFX7GaR8Wtc7GqoxHHUCkBQf+gIysu6sbvj5t0s8vbzd/5vBKOxm/aWEgjqDx1BxTDMkQp53s0i7GKAQ1CUoHPTkhBCgrqY0QZlcdWycKqn7yRBG5Qs+xWUXexvenHOulv19BPfkgdB/dmxoPsGV5JIAUG7QNBJ1DCPXv3YuxTUv3gpt+go5dQtzbOqeDbgw924zBSojwEEnWT0LvoZgk4xL1DP03IePzhXoD4GEHQS2oKqRDginNnCTDGAoJO0grKIDg+xi8uZ/N4QY6RHZxyH3sIE/e2Jb2WH6rEfb0+9gOi8OKhK2wjZAvUxgKCTtILqMehiWIcpaH8ch95SMxXlViGoOIwXq5Vt6Jw4KD9DZ+iIxTZLUGvdk8MJ+jeG46+J6iQVrAD69kkPOTJL0P44Dr2FHSn0aQo5IWjBK/2h0mxOJ4kXxM5Bc+QD9aaMKsp5Mv8gDurAbIOW7EYl1aI0BO2P49Bb6lq9oxK3NKn33C99Q1cKM5EO1H+1+fiRPeoloyDoJKagvEZWwzoMQfvjOG6WoPwdzaMpqAj+LG2DUmZCiq+DCEEFNQT1wBD0/fnXxrvpErRW3RFXCSpObtfNs25YLlh/bFbhGL7CXRBjUnSUtEtLrp99AAR1Ygh6e/yL3Tx0KfgrNcJDjyU2x3HoLeJFwd/92hO0E6qaFwd9ezrz4fejTAbqUwiq/i8MiNcTVLz42vVUAEFtWkGZTaxklMM6mpdsoFLz64uRHvY4Dr2llr14NTBJl7psX7W0BOVpOl2dAaTpQH0SQfmjrrrNkntEUPmn6ygEtVG9+IcXpiofb6TjoLz78bkXB+Wy9OKg19oSlN8Y2ul9zxOURbQccVCPMFMqQVWV3gkfuQU138schaD5mFPFn9kUO65LnR6B+jSCCj3NT/QW1GwdQNB8zOokNcWwNbtEFyIl6FCzM6QErVV93/Tzl6aFHvsV1IPpQH2C7FFNyClBJ7fZPaa9cGhBpwP1q2dP69QiQc2qftX0JufYgqY+Xffsp17jc0EJqnv2q6U3BxA05em6Zx+LeS7ZtjNFISiLao3eUrJu9pgXLaMJWu+rnl/0CzhX+ag604BVxuiO/o3K1dU57GMlQZtkF2//eB3/6FUFHeodRRB0X4Xokl/AvcpH51qQ5UBP0DXGJE3fbsdSLS76pw0zCZRF8QXdk6ILfoGJVT5yCyr++7hW+RCz7PEbqjIE6nX3yFO8iTgoP6K9ycXb0B3HQd2rfLCrmXKeRVb1s8fHP9nyHt94FW8M9WgefuN7uaTVSe5Qa3+EJVMfqId8jN/OJG5uef+v46i1BOUKjV/WnCuouc1T0f0K6ljlQ43q0M3N6nQVV9sfX2Ub1BjqoW7PE/Pa8jtHzu3aH4HJ1Ad6DJprr9OPrugZXVBevCkpVhXUsxDdmKBfnViHjq/yYYzzaO8m0oM6hKDsvXKohymoKPcqOUSkbQmsUoLqu/6q0XZAfEHZQxpBeT0/eUfrxgQNYHyVD31PstBOGGrdr2TdqGwKKnY0j9bNoSu1QYNOF4mEgtZGO3ec/Qo6XsXfTEHVAA5bUHOoR19Qa9xyWDKDevFBp4tDWkE9GqL7FXR8lQ+rBOWUnUEdKUrQKGxd0GlDdyzoaJipP87D7AYZbVB2u2ahfey0QRcKyleyq5dOybB5QeXl1HF2LKh7lQ/Vi1cDOJiKhqByqIcaGqL3tr34SII67qgPOV0s0gtauw3ds6DOVT50HFQN4ChlpPOu46BXeQo2NKTsxUEXCVq2IetiyTdcR9BJGeNu2/RVpei/wDrML0ETfW7YCdMKumlDdyto4s8NO2FiQbd8aR6CpjxdLkE3bCgETXm6bIJut5qHoClPl1HQrRq6W0GpxUGHpvVMIqj+2G0auntBqcRBTW3SxkH5o7xHtJ+uXcdB0xEqKL04aGZB+eOQoRA0CvNL0ESf63umrIIOGQpBo7D9ThIJQQdqeQgahTmC0rrdjoag/TIUgkZhhqDEblgmImjPUPKCbgTv76OeeA35SDjDMhVBu4ZSF3RvtJ0kn0FzCWdYpiEow77sCUHTElKCppkf1K4D8pegnQvzEDQtIW3QNDMsT/riKWjMbdu8qLQLQnrxiUrQgT+5Bd3oZc89EGRUkhmWSQoKQ3MRZlSKGZZpCgpDM9EaNRlCCjvd0lOQErTfmQeJaI0qYywBv1NB+SMMzYE2anQ+MJMUgXqygqKrlAND0OlrnEkC9QNuZI6DttsaQREHTYs2yrmElzqkUE/ThpnICFojUJ+a1qjxORUV2QL1EPS4GFX8aaoXf/QSlANB0xJkVK5APRFBazMtIA1hRmUK1EPQ4xLBqMing6DAII6g4TdKO84iXxh/IOhxCTNq3UD9qBu0BF3+PxH4E9hJKsSTdTpJnv6FCbXSNgiaiDajp28WWTvMBEFBjzajp28WWTtQD0FBD53RHjeLoATtvQBrYwjqc7PIqoF6CAp66Iz2uFlktUC9FaPaiKARwmrAgzaHe0t+LzvdjHdtSlD5Ap6ujMhafadIniEfU27QioOOHgBWICxrbye5AO7YNLcQFMQlKGvZinhsWTsICkFTYWQtW/1utHvOEGEmvtYoBB04AKxAm7VidUZRQA6jIlHNkRB04ACwAjprPWa304H68gxBBw4AK6CzVs9u55p+Ue5rOv0QdOAPiE+bteIykViZfgx1Ken9GYIO/AHxMbI23xz12xcU4fq1iJyp6wgaeECKbY4DQEwgKAQlTZupGWe3g6BgjDZTM85utxdB0RSNj85Nr9nt/E/nefjAQM4NC2ptA1EwBI1wt12woAN/ICgw0LnpdcOy/+mCDoegYIw2N6dntws6XcjhUz89/Tio9QJN0YgYVXyGG5b3Kaj1BywjcjZCUAgaFwgKQUmDKh6Ckqabja7Fjmeczu9wCArG6GVjuSjaBEEhaFx62bisCIWgEDQuvWx03VE/43Reh0NQMEY3G12D5maczu9wTzfCBF13m8ebEK6Pgc7AyWmXwk4XdPg+BTVfgLmEZWDsKcAhKJggKAOjTwF+AEFR0y/DyDleybtq+PgT2B5AUGsbCKbNOXE3080xrDP+FOAQFEygc04Vj+V4GYoSdOmJQDA65zymvok5Bfjool1DP/OG46AQdCFGCSoCoGNlIyfeFOBBrkHQ49LmnCgVq2VTi0BQCBoXkXPppwCHoMCLsJyLF6g/pqAIigYTlFkRA/VHE3RgoR3gg6zifzGLRPtVS8ww09EEHdgGfJCZ1TRC5V1MTS0+VoHHDNRDUOBFm1mVrIXGR8ejBK0haGqCMitmoN48POxnjuDG8m2LToS+kj9huZQpUL83QeULeOpB5OyBoDO3gRHiZE8b5g/7XBJukEgEGCEsezIF6iHocQnKnlyBegh6XNrsYVMs35y31GcLM0HQ49JmT/n4+vZ0ds0sgkB9HTMOCkF90NnD7GOjPnzW6kSgHoKmwhKULfThXKszU6Aegh4Xo4o/3y+Pr+6ZRSIE6ofu64GgYIw2exr5Hl6WLqXgIaj5B4LWuEfUTeSMgaDLtoEuOmPun8RgpLWnX4SgEDSEnqBrT78IQSFoCDJjyvZqejF6rMfQOggKQePSK0FdvD9PFa/rCBrdA4KJQF9pmLAcmezkQ9CF2+BphzYrvNaLn1ovEYJG3AZqMysSrRe/DTdIJALURlakWi9+G27kTgQqeoUhaJr14sm7QS4Rx0ZnQqr14jflBolEHJs2ExKtFz/npzpOHBSCdtGZkGoxWQjqvw1N0ej/SyHoCtsO7SkEpS+o9edo6K+NKt7vMyBoWrpfe/X14iEoBA2h97XXXi8egkLQEHpfGzcsu7dB0LT0vvZqNyzbnVEIGrztmH357hdeb734aD9VrsKLUiKOg/7Cq68Xvxc3MifiaAVp5G8KQZNuOwAQdJuJOEw5anzHt6fmKy9bCRGC5kjErmm/o5hv6bbsniYImjQRByhI9ZdTU9c5Vzv2P93orr24QS8R+0R/OZ/14gNON7przs+COOjwtkMJSrkEhaDD29SLPdf07bci3AaFoMPbhg7YG8a3otuLh6DD2zoH7LIcjfx9IGjuEhSCzj0dBE0j6M4KUvVFxKjjt6cizunGd0HQJCXobjyV34BNT2/+XXg6xy4ImkZQ68+Gkd+gVF4unAEHghITdPPlqEi7xwpIIadz7UpXbuR2g1AiNuypSLTHGnIhp3PtOpoblBKxRU+VoIXasN6Qj4E/x3GDUiI2palMZzuWs0QVf4xE2NRUkSl7e7p2ngwyb734gdFyx3aDYCLIaqrSJFffvDkW+Zi9XjzdnwWJsLfZRQkJafXni8LROaRz7mrH1H8WJKKzzVQzt7QhnzXe13e3ZU5L+fFjxps+flx+RKy0HJyZbgp5Ao6NFi0NRQXqg1CB+iVHxEoLmE2Q3dPrxa8DBD0uYcVvnNkdgoGgxyV3J80LCHpcIGiKtIDZQNAUaQGzgaAp0gJmk0jQZXE0xEFjk+ZXj0EqQdN8jBskQkEiEX5A0MQgEWFA0MQgEWFA0MQgEWFA0MQgEWFA0MQgEWFA0MQgEWFA0MQgEWFA0MQgEWFsKKngiEBQQBoICkgDQQFpICggDQQFpIGggDQQFJAGggLSQFBAGggKSANBAWkgKCBNCkGrxUuAzuXt5+9WAvpP1oZPu1pkTkR9G//sfD+OHwkErZoMqLJkwv3CpzHVCeg/WZv35+ZTbmxe4IyJ4AtjjHx2vh/Hk/UFFbOKls65m9ehEpPp6wT0n6yOmPK/ESRnIvgaLmyty5yJmMv6gurfaPVP6lCdCj4RtE5A/0mqlDy8ZE8EEzR7ImaQQNCfWAWybH2wuQhBVQL6TxIloxz67MSJuDX1ePZEzGB9QUULJ087h+e8TkD/SaJUNL2kzImoeE8te07MAIKunwjVR8rqxvvz42v2RMwAVfzqaeBRpvy1K2sIZ09EODvuJNVK0KxdA7n4Wf7+SfN5+RMRzp7DTFLQrMEVtTBK/lhXlTfWNZddB+pl3ZUxPP32VKikZIyRswWCuYoI1A9yy3Y1TTaudAL6T1bmJiY0Zp+VLxGNoU0arsOfne/H8QM3iwDSQFBAGggKSANBAWkgKCANBAWkgaCANBAUkAaCAtJAUEAaCApIA0EBaSAoIA0EBaSBoIA0EBSQBoIC0kBQQBoICkgDQQFpICggDQQFpIGggDQQFJAGggLSQFBAGggKSANBY1CKKZhOj6/D+++Xa9oE7QcIGoNyzEywFAgaAwi6GhA0BqagcqrD+6cvpw/fLp8v7BWr4u/yOT/i4QtbdONJzYoIRoGgMTAEZbMVsyVf7pdm2/3CFpp7eBGCiudsUZq6OsmlkyoY6gaCxkB1koqm4HwRc27z5d34Q/NKCFoYE8WXDy+Uly6gAwSNgd0GrVStrh+EoOK5npZcriQKnEDQGBiC3k6nD388OQS96Xnz+UrIqOHdQNAYtILyCvzNJWi7sAN/J+kJ4gkAQWPQCirWtnNV8XJpIikmQvgTQNAY2CXo/cJ6S2OC6l68XgYGOICgMVC9eBZIYo+liCwNC8qO/vA7t5T4EjAUgKB5QIzJEwiaGt4G5UFR4AEETQ6r2RFd8gWCAtJAUEAaCApIA0EBaSAoIA0EBaSBoIA0EBSQBoIC0kBQQBoICkgDQQFpICggDQQFpIGggDQQFJAGggLSQFBAGggKSANBAWkgKCDN/wH8YYoXnVPSgAAAAABJRU5ErkJggg==" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kink_est$e</code></pre></div>
<pre><code>## [1] 0.186233</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(kink_est$booted_e, <span class="dt">probs=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="dv">1</span>))</code></pre></div>
<pre><code>##         0%         5%        10%        50%        90%        95% 
## 0.09330628 0.11666582 0.13313885 0.18567137 0.23956820 0.25130516 
##       100% 
## 0.32462423</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kink_est$Bn</code></pre></div>
<pre><code>## [1] 1170.216</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(kink_est$booted_Bn, <span class="dt">probs=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="dv">1</span>))</code></pre></div>
<pre><code>##        0%        5%       10%       50%       90%       95%      100% 
##  599.0476  744.2115  851.2940 1166.8193 1481.8489 1541.6775 1939.3720</code></pre>
<p>Note: we modeled the earnings with elasticity of 0.2, but got an estimate of 0.186. That’s no so bad, considering that the width of the bins and the excluded area have an attenuating effect. We might not be very happy with the bootstrapped confidence interval we got. It’s pretty wide, both for the elasticity estimate and the amount of bunching. Since the number of observations allows it, and the simulation is pretty “clean”, we can try this with narrower bins (width 1 instead of 50), and excluded area (same number of bins, but bins are narrower!). This does shrink the confidence intervals, and gives a point estimate closer to the value we used to generate the data. Also, the plot title and x-axis label can be modified by the user. In this case, however, plotting is supressed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kink_est &lt;-<span class="st"> </span><span class="kw">bunch</span>(earning_vec, <span class="dt">zstar =</span> <span class="dv">1000</span>, <span class="dt">t1 =</span> <span class="dv">0</span>, <span class="dt">t2 =</span> <span class="fl">0.1</span>, <span class="dt">Tax =</span> <span class="dv">0</span>,
                   <span class="dt">cf_start =</span> <span class="dv">500</span>, <span class="dt">cf_end =</span> <span class="dv">500</span>,
                   <span class="dt">exclude_before =</span> <span class="dv">10</span>, <span class="dt">exclude_after =</span> <span class="dv">10</span>, <span class="dt">binw =</span> <span class="dv">1</span>,
                   <span class="dt">nboots =</span> <span class="dv">100</span>, <span class="dt">seed =</span> <span class="dv">123</span>, <span class="dt">draw =</span> F)
kink_est$e</code></pre></div>
<pre><code>## [1] 0.1932915</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(kink_est$booted_e, <span class="dt">probs=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="dv">1</span>))</code></pre></div>
<pre><code>##        0%        5%       10%       50%       90%       95%      100% 
## 0.1770582 0.1802953 0.1834727 0.1915006 0.2035105 0.2061229 0.2116499</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kink_est$Bn</code></pre></div>
<pre><code>## [1] 1223.928</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(kink_est$booted_Bn, <span class="dt">probs=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="dv">1</span>))</code></pre></div>
<pre><code>##       0%       5%      10%      50%      90%      95%     100% 
## 1127.625 1143.042 1164.198 1219.175 1284.605 1304.872 1332.322</code></pre>
</div>
<div id="analyzing-a-notch" class="section level2">
<h2>Analyzing a notch</h2>
<p>First, let’s create an earning distribution with a notch. This time, I will use <code>bunch_viewer</code> without trimming the vertical axis. Now, the excluded area is where the notch seems to be taking place. I want to make sure I have enough area inside the red lines (where counter-factual is calculated) and outside the green lines (the excluded area). Of course, in this particular case we could just set the red lines at both ends of the histogram. In other cases, however, we might want to limit the analysis area (e.g. there are other notches or kinks).</p>
<p>It’s best to set the cf_end variable so it lays to the right of what seems to be the end of the effect of the notch, but not too much to the right. The function uses the area between the red and green lines to calculate an initial counter-factual distribution, so you want to make it easy by having quite a few bins there. I would refrain from including areas with idiosyncratic density patterns in the counter-factual area, as it might make the interpolation harder and less accurate.</p>
<p>Basically, what we need to calculate the elasticity is the size of the notch, or <span class="math inline">\(\Delta z^*\)</span>. While this is clear in this case, where elasticity is heterogeneous it might not be so clear cut. The process goes like this: a counter-factual histogram is created. Then, the extra bunching (sum differences between the actual and counter- factual histograms from the beginning of the excluded area to the notch point) is calculated. That bunching comes from the right side of the histogram. Running on the bins to the right of the notch bin, the differences between the counter-factual and real histogram are added to the initial bunching sum (they should be negative). When the sum hits zero, the process stops and the current bin is declared the end of the notch. <span class="math inline">\(\Delta z^*\)</span> is the distance from the center of that bin to the notch point.</p>
<p>Notch analysis takes a little longer, mainly because of an iterative process in searching for the end of the notch.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">earning_vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(ability_vec, earning_fun, <span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dv">200</span>, <span class="dv">1000</span>)
<span class="kw">bunch_viewer</span>(earning_vec, <span class="dv">1000</span>, <span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">2</span>, <span class="dv">25</span>, <span class="dt">binw =</span> <span class="dv">20</span>)</code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqAAAAGACAMAAABFpiBcAAAAjVBMVEUAAAAAADoAAGYAOjoAOpAAZpAAZrYAiwA6AAA6ADo6AGY6OgA6Ojo6OpA6kNtmAABmADpmAGZmZjpmZmZmkJBmtrZmtv+QOgCQOjqQkGaQtpCQ27aQ29uQ2/+2ZgC2Zma2tma225C2/7a2///bkDrbtmbb/7bb/9vb////AAD/tmb/25D//7b//9v///8+MtA1AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAYTklEQVR4nO2dCXukuJ2Hsdcpu5MJ1dnN2DOzWySZJjvdVJnv//GCbnEJHRx/4Pc+z3SVKRBCvCMkoSOrASBMtnUEAHABQQFpICggDQQFpIGggDQQFJAGggLSQFBAGggKSANBAWkgKCANBAWkgaCANBAUkAaCAtJAUEAaCApIA0EBaSAoIA0EBaSBoIA0EBSQBoIC0kBQQBoICkgDQQFpICggDQQFpIGggDQQFJAGggLSQFBAGgg6RpU1PH/zP+Afct/Pj+zlu/i86D8G9gM+QNBhHtdMkHsf8OwlqNkP+ABBB2m8Urz7HVFkg4I69gM+QNBByix7uglPuWz3N5WZCsGaDDZnez3dCrFnYQoEQzloyX5mX/R+JkS+kQXUbG5C/O2NBch/ZgE3Z7pU/P8TGaeTAUGHaLRSsvFMsBSZqTDMFlTQeOMWVO7Y/K72s0IUufXTX8zml++VDliXNTJzhjMBQYdg2Zb1Z5OdCcvynqBCqrzziFdIQUVwlbWfHWLF9mPmirCksxe+U84FzWudh+Yrp8TmQNAhuBoGKV8hssCWoO9854tb0GYPnfWJ/QZDFILqMm/JA2i2N8qKfzvROgUQdIi2CeqZXYpnebsMqrJbl6ByCw+S72eHqL6rMujNDuMiQxf/QlAgaD/i1V8Vy970Izp3CNotg6qC5Lvczw5RfbcF5X6KXyAo6NOuJA3koIGC1qYe75WDiuAhaA1BR2g3M9klRqGQqPB4C/r5y61ulTjHy6Bc0EoVbnMIunUEaNJuqLfr3Pxf9nPeFrTUjZR9QcXxqsWJ7Tdei1c5qCi5IgeFoMPo5ke7HZR95y3osspjC1p5tIPKvNdqB73U3XZQUwZFJYkBQcdodRbhWr7rry//36vF10VmauC9Mig/XgQm97NCFLlnrxb/dCubTRAU0KDodXsCNQQlQMGLC6K5H3SBoJtTmTf6oAcE3R5RIcMDfhAICkgDQQFpICggDQQFpIGggDQQFJAGggLSQFBAGggKSANBAWkgKCANBAWkgaCANBAUkAaCAtJAUEAaCApIA0EBaSAoIA0EBaSBoIA0EBSQBoIC0kBQQBoICkgDQQFpICggzXkEzQ58sdn+8L60JdONFIcWdOsIBANBe0BQSkDQHhCUEhC0BwSlxEKCqtUn9rjoLgSlxDKClmqRiWqHq01AUEosIujnR66+lvubsBqCUiJCUDWX//vovo+r/q3a8iH/40fgAa+vtWgrTD0zDyiV4OhPc3xBzfK+eh3VPlRyUAja5fCCPv5mO9n+y6JU2eu2ZVAI2uXwgvqiVrDctgQKQbtAUFJA0C77u4sxgjbZ48v3Il8gNjMDQbucQtDq6dZUfR7X3LE3jYZ6CNrlDIKyKjqrm5cO+Yg01EPQLgkXVoj6RJVdrFbE2uRT97/+8SHXEbdrHpW973jLZOdXc1S4oCwgJqijhRPNTIcVtOo0fxtBqwtf975uC9qW2SVoO9QEQVUOWoyrR6WhPg68SRqE3++qu9KyEbR4//z4ry+3enNBZRm0dLxJopKDxgFBB2HaCT+ZPo/rz1f2MpELykp0n7/cPj8u5aVWKmdsdfv7G29qLJs/Ls2+f39TLyDvX357y0T5T+xphyqPCotxuxY/sWg5kYb6OE4kqBpTMfZp02gn80+hUvO9fLoxQfndvv/1eyMoz/q4ylzei8gLm/2YyeoYFkbj4LsoL9h7mlBTclAfaDTUx3EiQUMoXv6d2YLmzLL35lMUS6tL8+C8qMKfeIZWQjVVDFDHsO/3N7atHNqTh7q0oHsGgg5SZE//J6rpQqV3/uVx/Uk8JIt3LijzrRFUaChVk07qY+paedp42drThLqVoOGD9dYHgg5S8Oc0K2O2VXr6jdWMmiIoF5TVirWgUrX7F1EcbAnKt2lB5Z7pgqpHt7sRXuTplWsfwgpA0EFk1SfvCspzTFYEFYLWRe6Vg7YFXTkHFVU7dkGjLQurKIB20C7J7aCivtMWlDnWFEGloPcvfxktg9qP+FyE2dlzPUHlOcaamSDoNBQF/WyKoV1B66J5rL8rQZvCaqsWnwurVRVfC9psG6jFW6EGxtjsqB7z7ke8zNfHGuoh6DQUBW3u6/PvXZUe1z/9ctOCPq6mHVTqqtpBbUF1m2irHVTuUaS0gzYxLS+6YDEEctADCjovLn1axLyLz+uK/V/hetWZ8f9l7DdhsedNAYJ2OYegTb3sz9/4f+M0jvJCRp563hQgaJczCMqqXY+vtwlBZztvChC0CxlBvYkog7KOoEWe2A0Egk4DQeu4ZqaCVcgSO8tD0GkgaL3du3jCKYU3SZRYqKF+8oUo4ZSCoGMUI3Xe/vvCoTeIY0e7iXrE8zcFrrN9fkwVAAgrAEFHuH/57+Hb6tVVfvRoN3EN9TxSF8fe8qXCDOddHwg6Qvn8r+HGIS9BR492E9cOynCPNuoOroo+7/pA0GGaTEfkO2q4B3tq889GiYL9wF8wZmIkyHutvneP/vorK/eV8lWoCiM5xq12UIZr2HFAcPSAoMNUasCGHrrBrJTdm1h29fnxztvfm8xJ97LTGZV1NHsCs6+8R5MKIznGVjtoJnrw5ZEXGnbe9TmRoD8Yjs8WrGgn+4bkogfn15t4JWQ6JqvHKvuz/YhtHy17DD9/02F4xtjr0njW7Rw0FxTccqAdtEvChckenI11dq+kSj3QCz4e6XEVVoquSZahnaPF8DvV4831jD90OygE7ZJwYaWet1gL2mziNR+ZX7LpuvicR3IX+X3oaDMJsgojOcYQNDigVEgJqjt7mn6dPAOUj/im7vO/X+VDtbDGDRfiSds9Wk8AocNIjrHdYZkNhU4cUQxBpyElqFJKjVqXFSPZIZ4N6fxJGWGP2VAlgf7RMlgVRnKMW+2g97cLr37FA0GnISWoms+mKUzaOejjmsnO6XzCOC6iHGCkvg8dLSruhRgzx8NIjnGrHZQpnzbrEgSdhpKg5ilc8CEfqgz6dFMPdDlOU9SfdUFTzSPSOVoUSplBKozkGLcEZbWxHbSDQtAuCyY7G3i8ADGP+Atra3W/6pzvvCn07vCYespJCBpPmS8SbNyozqfb5Mv2uc6bQl/QkfOqtnkIGsv9baFpuA7dzDRwVreg/T8Oxv4u7JyC8jzSmiQKgpLlpIJKC5WLEJQsBxZUZ4/sU/zhFDRT+eoe76Mn+7uwIwvass981h1BLXetz2OScGFFNjInca+7cm8ie3tL6MCPEwoqctS6I6TKOSHoCKOLZgQJGjzwI0bQnXS3GxXUzjaHfoKgQ8wjaPDAjwhBxXg51yofc5435RSiIXEgexzKQdk/r6/a3TQO2A5qBC15r868NpPWmQ4g7M3lr0xHPaRDb2GED/wIF1QP+aA+s4gt6Eg2CUH9MYLqtQbV4h1GUPYOvMrk6A4xpENt4YQP/AgX1G/QnHdwyzEsaKdG1M5cX1+zUwn6ynB82qhKUs5u/e9fb/bEya0eoqI/KPutUURvkYEED/w4eA7aerTblSPkoKHYZdCCza1pTT3f6iHKskk9pENv4btGDPw4ehnUXROCoP7YgvIextbiHUrQUguqhnSULUEjBn4ctRbPLYOgXeYR9PPjfxrvpnPQWhUEq/iBHzGCzsGCgqpX7ELQwVZ4CBqOJWj58gebJPaa87/UTPWNYMIxey1DvYX9ETPwI6KSJMdGka0kGeWQg3aZRVA16N0s3vH5wdaTYY9qPq22qqoX8ouqxccM/IgX1Nmjno84zbZZyAuCjpMiqCwwPt2YZ/xpbRbvYPMZ/txrB+V337SDRg38CBVURVM1sA5Tqh9HJ8FbRVCHmJO7HJP9XVh8DurAY734BVJKd/KEoKPs78IWqSRZb2dXXMhrqBUegrbZ34UtIugGOahHKzwE3eOFLSKoacVfrQwaZh8E3Q3LCKpnqR99HQpBN2F/FxZfSaLVDgpBvdjfhcULSmtmkUHV0A7a5fiC+rWDrtxQP/Y+E4J2Ob6gXu2gazfUj9kHQbucQVAP1m5mgqC+nEPQye52azfUQ1BfTiHodIdl5KBkBd0f3pemvvgM+VivoZ5fAgQFxiivQXOrNdQ77YOgJyIoBw0ILpGsdgx6h6AnIqQM6ggluGgxHa2I10SnfZN0YKx75jFobrWGeggKBEH3bL2GeggKBCH3bK1mpiwLGbIJQQ+NuWeTj+/VGuqj7YOgx8Pcs2KyG9NqOSgEBQp9z9R4fRerNNSPNy9B0BNiCerRvrRGQ/20fWgHPRH6nqUu4dUJLiUICAo05p65Fk+OCC4hCAgKNNYjPpuqxYcElxIEBAWamesNEHQaCBpCyD3Tmex4PgtBp4GgIQTds8+Pqed/kgJTb5Ag6AkJu2eTVf00QSesg6AnJPCeTVX1DyuoOBqCrg6lSpKvoCm7JMZttg6vwBOT4NOdRYKCizuYuqBz/w8NpjAJPt1ZJCi4uIOdg+W2FlTGDayJTnCfziIBwUUejBwUtLEEneFNJwQFM6MTnEBnEQgKepgEH14RLDq4uIMhKGgjEtzjJWZIcBHHZQH2bdIOWouAsjq5xR/toCHMnCNECxqSPW4taGKqQdAQIKj3hUHQLbCSmi2FNzrYKDy4wOP2IqgqjMQDQUMwSS2WBGVrKs8SXOhxexFUfE0JC4KGoNPZa3Y7/+CCj9uXoCmZKAQNQaeznt1ufUFb7zd3I2j0XGkQNASTxGLQ+/0tnye4sIOIC6oKnq0cNNZSCBqClboes9uFBBd0EHVBhx7x1mcQEDSEhKfebMGJ2zw9o0iAw6M/xV6W6wToJbogdASdwb6NBJ09FYHBJO12HZYPICgy0aUw6bpdh+UDCIpMdCl0um7YYRmCglEsQbfpsNwdDA9BgY1O1606LM9p3+aCoiw6OyY9N5rdLsI+eu2gWW33aJ0A7aAhWI/4bTosH0ZQOyd1AkFDmPmJBEEh6LxAUL9I+gjq2VUUgoaw5SN+cJaGHQuKHHQBuumZ1h00UNBptSDo2emlZ7Fej/qsHlhzZveCTp4GgobQS8wVe9QfNQedOBEEDaGXlM4e9fOudnxYQd3ngqAhdNPROWhu5tWOYwVN2SWOoDjIr3ipNAs6EScXkZt/rc5jC5pwOmAIScS5VzuGoGCSkEREDgpBV8dKRP6QdzzhZ1/tGIKCSUwiit5MpXNY57yrHR9eUFST0tFJqJ7fhTMP9Q7Oc+djC4qqfDo6/dae+qbbkz7Avh20g7pyUrSDhmDloKIBdKz6I3earaE+IXvcnaDtZIGgIZikExWfylUGnbOhHoICH0TS+U0BPmszEwQFPoTcs/GGeqN3yInPIWjWXf4LgoYQcs+Qg0bnoPa5IWgIIt0ef7MzxPZfFvM11I/PFHZMQe2UgaAhyHRrCqGyF1NTUR8vhc7WUB9xeyHoKTHpVslSZNLoeAjqFJTH4ccPNN/7M3NKrSJoyi6xlxUQB5egtffYTyAISSkxv1g1R0P9CQW1h7BCUG+CBeX199GZxiCob/SAH6GCSjVTm5kgKPAjVFC5JnJqj/pzCtpaMRc1JS+2yEEHZxQ5g6ADu8DSCUz6MP1KZ5d60Qp6qR3TMfsJetYc1NrFflEBHJj0KV6+398uEzOLNI4+3RxLzq4i6F7bQTMdffm195oe9NDpw57dbNTHCh2WIWh7E3DQEpQt9LHCWp0Q1N6EYqgTkzjF5XF9+b7GctwQtPcTGMMkDi9epi6lAEEh6LzMnDgQNEZQPOXH0Snz+CoGIy1dSRobzXlmQZGJjtMTdOlKUurthaDnQqZMYUYV5TME594DgkJQb3o56EzBufZIFTRll9jLCohDVPRQCh1h5nSBoAnRAwOYdFlpvXgICkFDMOmyxnrxerwDBB36DJxa4BTo5FhlvfhFb+/OBdX/70JRG0vQFdaLh6BePwlXISpDJ8Iq68VD0MCfgEmENdaLn+f2HrIddOTo0+ej+vJXWUwWgvoK2hqkfGZmvnwIOmcOijkeIKjvZW0iKHJQ6/LxiHfGe2NBz9tC2r3oJdeLb48Lh6DeR5seiuejd9ELrhfvdQ8hqOvzfPQuesEOyxAUggbTu+gFOyxD0ChBzz3HQ/eilxzVOZegKbvEXlZAHNKuYOLo01WV9OV6rBcfEtzwjxA06egztovOfLkQdElBxee5MlEI6ndZhASta9Xb6QyiWtd4f2su2bkad1BwQz9C0JmPPj7mGsWUdeVSq3x052iHoDMcfYL3S/ry1DJyztWO/YMb+gWCznd0e/qLA1uqr2zp9eJnvEEnawf13OWg6CvbUQ4KQVufx54G11zZ0mVQCIocNALrypatxUPQRQU9bH1p5muCoBsJKj4tYi+VGusI2p1zEYIuI6i9i072faMuQIw6vr/l8wTX3wxBNxB09IbsB3kBbHp6+zMxuIHNEBSCxiAvoFBeJs6AA0GpCJrp+Un2/ZwXcVeNoPVC7aDzCpqyS+xlrXYFi1x/y9Z96Spia03MtMibpK1v0NkF7fy0J5SgudqwyJAPOjco9rIOIGh3+rx95KUyjmYsZ4FH/FD8DyCo9ZN81FuPfLKPfhkruQy89WWQyVmYIeguBG1/ZjpzJSiqio1cwLh0LvKhfx1d7hiC7lBQ9ZnZpQAqbQD67CJzdA7p9KjrD15Ma+AsBN30+n2OVl3LW58tUVfUNuQ843V99yvgbGZ+/Ag84PV1pjPPElBw9HdPpJtCnoB9Z2stTYS1dAfx+sr+neF/ehFQIsHRPzVBN013Fh0tg64CBD0RYTdtntkdUoGgJ2LbKlocEPREQNDwgBKBoCFA0PCAEoGgIUDQ8IASgaAhrCLozM1qaAedgzVu/AysI+gaJ5kG0bCgEYtpIOjq0IgGjVhMA0FXh0Y0aMRiGgi6OjSiQSMW00DQ1aERDRqxmAaCrg6NaNCIxTQQdHVoRINGLKaBoKtDIxo0YjENBF0dGtGgEYtp9hJPcFIgKCANBAWkgaCANBAUkAaCAtJAUEAaCApIA0EBaSAoIA0EBaSBoIA0EBSQZnlBq+QFQOO5//lbKwr9L8vDJ17NN49GOX7yLe/QJIsLWjXXXm10/Y8rn8ZUR6H/ZXk+P5rzlGxm4E2jwdbGGDn5lndomqUFFXOKFs6Zm5eiEpPp6yj0v6yAmPS/8WPTaPBlXNhyl9smRgRLC6rvz8LnGaDKcj4RtI5C/8t6cXm6bR8NJuj2sQhkcUG/sGdH2upg8QhBVRT6X1aLSDF09rWjUTbP8e1jEcjSgorCzVZFHJ7sOgr9L6vFo6klbR2NilfVto5FMBB0jWioOtK20fj8ePm+fSwCwSN+hVjwVqbNoyFKwtvHIowDV5JqJejG9QK5/NnW0RBRIBCLMI7czCQF3bhlRS2Nsmk0hIXVxo1dMRy6oV4+uDZtm76/5SoyW0aDrRHMVURDfZdywxdpsmSlo9D/sjilmM+YnW3LaNRFE4n34ZNveYcmQWcRQBoICkgDQQFpICggDQQFpIGggDQQFJAGggLSQFBAGggKSANBAWkgKCANBAWkgaCANBAUkAaCAtJAUEAaCApIA0EBaSAoIA0EBaSBoIA0EBSQBoIC0kBQQBoICkgDQQFpIKgffDEZtZ7MMI/r+8ihcmpDNkf8+BFiAjpHOOcEgvoh5aqyCHnUQe6DIeggENQPKWgvE/ThcRUHsSkQx4Ggg0BQP5SZjWRcoOafx/XnK5vS0Hya73y6w6df5ayGBX/G87WK1DSIj6+/Zs+/X9/Nlvvb3994EYKHX7qLE+cBgvph5aBGULaG3NPNfDJBxXfuZKWm3ZTzG7O/2EzG7PfHtclOeUhqy/2N/5PzraX8DiCoH1LQUuaUQtCcu2c+32v1XShZSEHFwewJ//h6E77yHfkRaovwsXz+poKmu7DBmkBQP1Qt/r22BO1/qu9m7nEOW6JAlzGrzLLcbNHZLDucH6iPODMQ1A+eCd7fWE7oI2jZFpQ/tfmmpmz5/K83W1C1RSwH0/zLBM30/w5nB4L6IZ7Sla7EhOWgzeP9Dx4AzxTvtqB6Sz8HBTUE9UWWQQtev8l1mXNMULn4kPasevrNrJdV2Y94vUWWQXkrAVqaNBDUDykoq3yzFQWbIqlT0HYtnh3+E28EFZlnlrdzUL6F1+KVu1ztAvkoBPVFtYOWXK4s+9n9iOetm8//NNVwudycWPKlEG1SugzKt4h2UGtrhkp8DUEXBe1E6UDQReBlUNGaCZKAoMtQoZVoHiAoIA0EBaSBoIA0EBSQBoIC0kBQQBoICkgDQQFpICggDQQFpIGggDQQFJAGggLSQFBAGggKSANBAWkgKCANBAWkgaCANBAUkAaCAtL8Bwf8Isx3tszqAAAAAElFTkSuQmCC" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">notch_est &lt;-<span class="st"> </span><span class="kw">bunch</span>(earning_vec, <span class="dt">zstar =</span> <span class="dv">1000</span>, <span class="dt">t1 =</span> <span class="fl">0.1</span>, <span class="dt">t2 =</span> <span class="fl">0.1</span>, <span class="dt">Tax =</span> <span class="dv">200</span>,
                   <span class="dt">cf_start =</span> <span class="dv">20</span>, <span class="dt">cf_end =</span> <span class="dv">50</span>, <span class="dt">force_after =</span> <span class="ot">FALSE</span>,
                   <span class="dt">exclude_before =</span> <span class="dv">2</span>, <span class="dt">exclude_after =</span> <span class="dv">25</span>, <span class="dt">binw =</span> <span class="dv">20</span>,
                   <span class="dt">nboots =</span> <span class="dv">100</span>, <span class="dt">seed =</span> <span class="dv">123</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">notch_est$e</code></pre></div>
<pre><code>## [1] 0.1843316</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(notch_est$booted_e, <span class="dt">probs=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="dv">1</span>))</code></pre></div>
<pre><code>##        0%        5%       10%       50%       90%       95%      100% 
## 0.1203677 0.1407937 0.1621033 0.2074509 0.2074509 0.2074509 0.2074509</code></pre>
<p>The example above is a good one: _delta_zed seems to be the actual end of the notch. Sometimes, the output plot will show <span class="math inline">\(\Delta z^*\)</span> not concurring with what visibly seems like the end of the notch. This usually means that the elasticity estimates will be wrong. In that case, it might be useful to change the <em>exclude_after</em> parameter and see if the plot come out better.</p>
<p>Another option is using the <em>force_after</em> option to set the end of the notch manually. Howerver, this means that not all bunching comes from inside the notch. When using this option, make sure to understand exactly what is the parameter you are estimating.</p>
<p>Another issue is the counter-factual distribution. For larger notches, the interpolation is harder. Remember the interpolation is based on the histogram bins outside the excluded area (green lines) but inside the analysis area (red). If the counter-factual distribution in the output plot does not seem convincing, a few measures can be taken:</p>
<ul>
<li>Widen the counter-factual analysis area (red lines).</li>
<li>Change the order of polynomial used to construct the counter-factual.</li>
<li>Change the option of model selection for counter-factual.</li>
</ul>
<p>As for the distribution of bootstrapped estimates, note that it might be less “smooth” than in the kink analysis. Recall that the major change in the different runs is the estimated number of bins forming delta_zed. As these are integers, the distribution of estimates will not be very smooth. With narrower bins, there should be more potential values for the elasticity estimates.</p>
</div>
<div id="the-importance-of-sample-size" class="section level2">
<h2>The Importance of Sample Size</h2>
<p>How meaningful is a having a large sample size? This demonstration shows some of the effects of sample size on kink estimations. First, I’ll use a small earning vector: 10,000 observations in total. The confidence interval is quite large.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ability_vec_small &lt;-<span class="st"> </span><span class="dv">4000</span> *<span class="st"> </span><span class="kw">rbeta</span>(<span class="dv">10000</span>, <span class="dv">2</span>, <span class="dv">5</span>)
earnings_small &lt;-<span class="st"> </span><span class="kw">sapply</span>(ability_vec_small, earning_fun, <span class="fl">0.2</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="dv">1000</span>)
kink_est &lt;-<span class="st"> </span><span class="kw">bunch</span>(earnings_small, <span class="dt">zstar =</span> <span class="dv">1000</span>, <span class="dt">t1 =</span> <span class="dv">0</span>, <span class="dt">t2 =</span> <span class="fl">0.1</span>, <span class="dt">Tax =</span> <span class="dv">0</span>,
                   <span class="dt">cf_start =</span> <span class="dv">10</span>, <span class="dt">cf_end =</span> <span class="dv">10</span>,
                   <span class="dt">exclude_before =</span> <span class="dv">1</span>, <span class="dt">exclude_after =</span> <span class="dv">1</span>, <span class="dt">binw =</span> <span class="dv">50</span>,
                    <span class="dt">nboots =</span> <span class="dv">100</span>, <span class="dt">seed =</span> <span class="dv">123</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kink_est$e</code></pre></div>
<pre><code>## [1] 0.1662341</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(kink_est$booted_e, <span class="dt">probs=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="dv">1</span>))</code></pre></div>
<pre><code>##         0%         5%        10%        50%        90%        95% 
## 0.04387312 0.07718377 0.09195058 0.17941217 0.28779019 0.30870107 
##       100% 
## 0.39275768</code></pre>
<p>Now, let’s look at a much larger vector, of one million observations. Naturally, the confidence interval generated is much smaller. Note that, with a larger population, we could reliably narrow the bins and get a more accurate estimate.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ability_vec_large &lt;-<span class="st"> </span><span class="dv">4000</span> *<span class="st"> </span><span class="kw">rbeta</span>(<span class="dv">1000000</span>, <span class="dv">2</span>, <span class="dv">5</span>)
earnings_large &lt;-<span class="st"> </span><span class="kw">sapply</span>(ability_vec_large, earning_fun, <span class="fl">0.2</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="dv">1000</span>)
kink_est &lt;-<span class="st"> </span><span class="kw">bunch</span>(earnings_large, <span class="dt">zstar =</span> <span class="dv">1000</span>, <span class="dt">t1 =</span> <span class="dv">0</span>, <span class="dt">t2 =</span> <span class="fl">0.1</span>, <span class="dt">Tax =</span> <span class="dv">0</span>,
                   <span class="dt">cf_start =</span> <span class="dv">50</span>, <span class="dt">cf_end =</span> <span class="dv">50</span>,
                   <span class="dt">exclude_before =</span> <span class="dv">5</span>, <span class="dt">exclude_after =</span> <span class="dv">5</span>, <span class="dt">binw =</span> <span class="dv">10</span>,
                   <span class="dt">nboots =</span> <span class="dv">100</span>, <span class="dt">seed =</span> <span class="dv">123</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kink_est$e</code></pre></div>
<pre><code>## [1] 0.183655</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(kink_est$booted_e, <span class="dt">probs=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="dv">1</span>))</code></pre></div>
<pre><code>##        0%        5%       10%       50%       90%       95%      100% 
## 0.1688440 0.1742967 0.1772704 0.1850824 0.1928552 0.1942905 0.1970645</code></pre>
<p>In fact, with a larger population, we could reliably narrow the bins and get a more accurate estimate. Using only 10 bins before and after the bunching bin:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kink_est &lt;-<span class="st"> </span><span class="kw">bunch</span>(earnings_large, <span class="dt">zstar =</span> <span class="dv">1000</span>, <span class="dt">t1 =</span> <span class="dv">0</span>, <span class="dt">t2 =</span> <span class="fl">0.1</span>, <span class="dt">Tax =</span> <span class="dv">0</span>,
                   <span class="dt">cf_start =</span> <span class="dv">50</span>, <span class="dt">cf_end =</span> <span class="dv">50</span>,
                   <span class="dt">exclude_before =</span> <span class="dv">1</span>, <span class="dt">exclude_after =</span> <span class="dv">1</span>, <span class="dt">binw =</span> <span class="dv">5</span>,
                   <span class="dt">nboots =</span> <span class="dv">100</span>, <span class="dt">seed =</span> <span class="dv">123</span>, <span class="dt">draw =</span> F)
kink_est$e</code></pre></div>
<pre><code>## [1] 0.1949573</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(kink_est$booted_e, <span class="dt">probs=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="dv">1</span>))</code></pre></div>
<pre><code>##        0%        5%       10%       50%       90%       95%      100% 
## 0.1879073 0.1901380 0.1915570 0.1955756 0.1988548 0.2003031 0.2025746</code></pre>
</div>
<div id="looking-for-trouble" class="section level2">
<h2>Looking for Trouble</h2>
<p>Generally speaking, the estimation strategy in these procedures are likely to attenuate, rather than exacerbate, the estimates for elasticity. However, it is worthwhile to see what happens if, by mistake, we specify the wrong earnings or elasticity.</p>
<p>We can simulate an earning vector with no bunching and see the estimates, and run <code>bunch</code> on it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">earning_vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(ability_vec, earning_fun, <span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="dv">1000</span>)
<span class="kw">bunch_viewer</span>(earning_vec, <span class="dv">1000</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">binw =</span> <span class="dv">50</span>, <span class="dt">trimy =</span> F)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kink_est &lt;-<span class="st"> </span><span class="kw">bunch</span>(earning_vec, <span class="dt">zstar =</span> <span class="dv">1000</span>, <span class="dt">t1 =</span> <span class="fl">0.1</span>, <span class="dt">t2 =</span> <span class="fl">0.1</span>, <span class="dt">Tax =</span> <span class="dv">0</span>,
                   <span class="dt">cf_start =</span> <span class="dv">50</span>, <span class="dt">cf_end =</span> <span class="dv">50</span>,
                   <span class="dt">exclude_before =</span> <span class="dv">1</span>, <span class="dt">exclude_after =</span> <span class="dv">1</span>, <span class="dt">binw =</span> <span class="dv">10</span>,
                   <span class="dt">nboots =</span> <span class="dv">100</span>, <span class="dt">seed =</span> <span class="dv">123</span>, <span class="dt">draw =</span> F)</code></pre></div>
<pre><code>## Error in kink_estimator(earnings, zstar, t1, t2, cf_start, cf_end, exclude_before, : No change in marginal tax rate - can't calculate elasticity!</code></pre>
<p>Woops! Can’t do this. The formula for elasticity includes the logarithm of the proportion of net-of-tax rates before and after the kink. Setting them equal generates a NaN, as the zeroed logarithm term is in the denominator.</p>
<p>But let’s see what <code>bunch</code> does when we try to estimate a marginal tax rate change, when in fact there was no change. Presumably, as there is no visible bunching, the estimates would be zero. Indeed:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kink_est &lt;-<span class="st"> </span><span class="kw">bunch</span>(earning_vec, <span class="dt">zstar =</span> <span class="dv">1000</span>, <span class="dt">t1 =</span> <span class="dv">0</span>, <span class="dt">t2 =</span> <span class="fl">0.1</span>, <span class="dt">Tax =</span> <span class="dv">0</span>,
                   <span class="dt">cf_start =</span> <span class="dv">50</span>, <span class="dt">cf_end =</span> <span class="dv">50</span>,
                   <span class="dt">exclude_before =</span> <span class="dv">1</span>, <span class="dt">exclude_after =</span> <span class="dv">1</span>, <span class="dt">binw =</span> <span class="dv">10</span>,
                   <span class="dt">nboots =</span> <span class="dv">100</span>, <span class="dt">seed =</span> <span class="dv">123</span>, <span class="dt">draw =</span> F)
kink_est$e</code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(kink_est$booted_e, <span class="dt">probs=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="dv">1</span>))</code></pre></div>
<pre><code>##          0%          5%         10%         50%         90%         95% 
## 0.000000000 0.000000000 0.000000000 0.000000000 0.001648733 0.003649318 
##        100% 
## 0.008581313</code></pre>
<p>What would happen if bunching does occur, but we did not specify the tax rates correctly when running <code>bunch</code>? Let’s create an earnings vector with a tax rate change from 0% to 30%, but run <code>bunch</code> for a smaller tax change, 0% to 20%. As the observed bunching is higher than what would be expected for a change from 0% to 20% with elasticity of 0.2, <code>bunch</code> estimates a higher elasticity of earnings. This kind of user-induced error cannot be detected, so make sure to input the parameters correctly.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">earning_vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(ability_vec, earning_fun, <span class="dt">elas =</span> <span class="fl">0.2</span>, <span class="dt">t1 =</span> <span class="dv">0</span>, <span class="dt">t2 =</span> <span class="fl">0.3</span>,
                      <span class="dt">Tax =</span> <span class="dv">0</span>, <span class="dt">zstar =</span> <span class="dv">1000</span>)
kink_est &lt;-<span class="st"> </span><span class="kw">bunch</span>(earning_vec, <span class="dt">zstar =</span> <span class="dv">1000</span>, <span class="dt">t1 =</span> <span class="dv">0</span>, <span class="dt">t2 =</span> <span class="fl">0.2</span>, <span class="dt">Tax =</span> <span class="dv">0</span>,
                   <span class="dt">cf_start =</span> <span class="dv">50</span>, <span class="dt">cf_end =</span> <span class="dv">50</span>,
                   <span class="dt">exclude_before =</span> <span class="dv">1</span>, <span class="dt">exclude_after =</span> <span class="dv">1</span>, <span class="dt">binw =</span> <span class="dv">10</span>,
                   <span class="dt">nboots =</span> <span class="dv">100</span>, <span class="dt">seed =</span> <span class="dv">123</span>, <span class="dt">draw =</span> F)
kink_est$e</code></pre></div>
<pre><code>## [1] 0.2947799</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">quantile</span>(kink_est$booted_e, <span class="dt">probs=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="dv">1</span>))</code></pre></div>
<pre><code>##        0%        5%       10%       50%       90%       95%      100% 
## 0.2768846 0.2869495 0.2881759 0.2964715 0.3046559 0.3057848 0.3113277</code></pre>
</div>
<div id="comparison-with-existing-packages" class="section level2">
<h2>Comparison with Existing Packages</h2>
<p>To my knowledge, no other <em>R</em> package for bunching analysis is publically available at the time of release of this current version. Chetty <em>et al</em> (2011) did distribute their <em>Stata</em> code, which was used for kink analysis, and I will use it to validate <em>bunchr</em> for kinks. Unfortunately, I cannot use it with the original administrative data used by the researchers. However, I can run a simulation and test for similarity in results. The <em>Stata</em> program was written by Tore Olsen, and can be found in Raj Chetty’s <a href="http:/www.rajchetty.com/chettyfiles/bunch_count.zip">website</a>. To replicate these results, you will need a copy of <em>Stata</em> of course. Download and install the <code>bunch_count</code> function for <em>Stata</em>, and define the working directories properly.</p>
<p>First, I create a dataset with <code>bunchr</code>. The <em>Stata</em> function requires collapsed, binned data. I use <code>bunch_viewer</code> to create and export that. Note that <code>bunch_viewer</code> will create the histogram by placing the kink point in the middle of a bin.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1982</span>)
ability_vec &lt;-<span class="st"> </span><span class="dv">4000</span> *<span class="st"> </span><span class="kw">rbeta</span>(<span class="dv">100000</span>, <span class="dv">2</span>, <span class="dv">5</span>)
earning_vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(ability_vec, earning_fun, <span class="fl">0.3</span>, <span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">0</span>, <span class="dv">1000</span>)
data &lt;-<span class="st"> </span><span class="kw">bunch_viewer</span>(earning_vec, <span class="dt">zstar =</span> <span class="dv">1000</span>, <span class="dt">binw =</span> <span class="dv">50</span>, <span class="dt">report =</span> T)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">cbind</span>(data$mids,data$counts))
<span class="kw">colnames</span>(sim_data) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;earnings&quot;</span>,<span class="st">&quot;counts&quot;</span>)</code></pre></div>
<p>Now, save the simulated earning histogram in comma delimited file, which is easy to read in <em>Stata</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.csv</span>(sim_data, <span class="dt">file=</span><span class="st">&quot;sim_data.csv&quot;</span>, <span class="dt">row.names =</span> F)</code></pre></div>
<p>Now, run this code in <em>Stata</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">insheet using <span class="st">&quot;sim_data.csv&quot;</span>, clear
bunch_count earnings counts, <span class="kw">bpoint</span>(<span class="dv">1000</span>) <span class="kw">ig_low</span>(-<span class="dv">10</span>) <span class="kw">ig_high</span>(<span class="dv">10</span>) <span class="kw">low_bunch</span>(-<span class="dv">1</span>) <span class="kw">high_bunch</span>(<span class="dv">1</span>) <span class="kw">plot</span>(<span class="dv">1</span>) <span class="kw">binwidth</span>(<span class="dv">50</span>)
outsheet using <span class="st">&quot;compare_results.csv&quot;</span>, replace <span class="kw">delim</span>(<span class="st">&quot;,&quot;</span>)</code></pre></div>
<p>This will generate a plot, output some estimates, and change the dataset so the estimated counter-factuals are included as the <em>plotabc3</em> variable. Then, the data will be exported as a .csv file which we will import back to <em>R</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">chetty_res &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file =</span> path)
chetty_res &lt;-<span class="st"> </span>chetty_res[<span class="kw">order</span>(chetty_res$earnings), ]</code></pre></div>
<p>Now, we can run <code>bunch</code> on the data. I use the same specification regarding the bin width, counter-factual area, excluded area, and correcting for shift on the right side of the notch. The main difference is that, since <code>bunch</code> calculates the estimated elasticity, it needs the marginal tax rates as inputs (this will not matter for the counter-factual estimation). Also note that I shut down the default option for model selection for the counter-factual (mostly useful for notches, and non-existing in <code>bunch_count</code>), and use the default <span class="math inline">\(7^{th}\)</span> degree polynomial.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">estim &lt;-<span class="st"> </span><span class="kw">bunch</span>(earning_vec, <span class="dt">zstar =</span> <span class="dv">1000</span>, <span class="dt">t1 =</span> <span class="dv">0</span>, <span class="dt">t2 =</span> <span class="fl">0.2</span>, <span class="dt">Tax =</span> <span class="dv">0</span>, 
               <span class="dt">cf_start =</span> <span class="dv">10</span>, <span class="dt">cf_end =</span> <span class="dv">10</span>, <span class="dt">exlude_before =</span> <span class="dv">1</span>, <span class="dt">exclude_after =</span>  <span class="dv">1</span>,
               <span class="dt">binw =</span> <span class="dv">50</span>, <span class="dt">max_iter =</span> <span class="dv">200</span>, <span class="dt">correct =</span> T, <span class="dt">select =</span> F, <span class="dt">poly_size =</span> <span class="dv">7</span>,
               <span class="dt">draw =</span> F)</code></pre></div>
<pre><code>## Error in bunch(earning_vec, zstar = 1000, t1 = 0, t2 = 0.2, Tax = 0, cf_start = 10, : unused argument (exlude_before = 1)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># creating comparison data-frame</span>
bunchr_res &lt;-<span class="st"> </span>estim$data
comp_data &lt;-<span class="st"> </span><span class="kw">cbind</span>(bunchr_res, chetty_res)</code></pre></div>
<pre><code>## Error in data.frame(..., check.names = FALSE): arguments imply differing number of rows: 72, 71</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">comp_data$cf_diff &lt;-<span class="st"> </span>comp_data$cf_counts -<span class="st"> </span>comp_data$plotabc3</code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object 'comp_data' not found</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">comp_data$per_diff &lt;-<span class="st"> </span><span class="dv">100</span> *<span class="st"> </span>comp_data$cf_diff /<span class="st"> </span>comp_data$plotabc3</code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object 'comp_data' not found</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">show_data &lt;-<span class="st"> </span>comp_data[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>)]</code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object 'comp_data' not found</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(show_data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;earnings&quot;</span>, <span class="st">&quot;counts&quot;</span>,
  <span class="st">&quot;bunchr_cf_counts&quot;</span>, <span class="st">&quot;bunchcount_cf_counts&quot;</span>, <span class="st">&quot;diff&quot;</span>,
  <span class="st">&quot;percent_diff&quot;</span>)</code></pre></div>
<pre><code>## Error in colnames(show_data) &lt;- c(&quot;earnings&quot;, &quot;counts&quot;, &quot;bunchr_cf_counts&quot;, : object 'show_data' not found</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># write.csv(show_data, file=&quot;show_data.csv&quot;, row.names=F)</span>

<span class="co"># plot the results</span>
<span class="kw">plot</span>(show_data$earnings, show_data$counts, <span class="dt">type=</span><span class="st">&quot;h&quot;</span>,
     <span class="dt">main=</span><span class="st">&quot;comparing bunching counter-factuals&quot;</span>,
     <span class="dt">xlab=</span><span class="st">&quot;earnings&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;counts&quot;</span>,
     <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">200</span>,<span class="dv">2000</span>))</code></pre></div>
<pre><code>## Error in plot(show_data$earnings, show_data$counts, type = &quot;h&quot;, main = &quot;comparing bunching counter-factuals&quot;, : object 'show_data' not found</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">points</span>(show_data$earnings, show_data$bunchr_cf_counts, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">pch=</span><span class="st">&quot;*&quot;</span>)</code></pre></div>
<pre><code>## Error in points(show_data$earnings, show_data$bunchr_cf_counts, col = &quot;red&quot;, : object 'show_data' not found</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">points</span>(show_data$earnings, show_data$bunchcount_cf_counts, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,<span class="dt">pch=</span><span class="st">&quot;*&quot;</span>)</code></pre></div>
<pre><code>## Error in points(show_data$earnings, show_data$bunchcount_cf_counts, col = &quot;blue&quot;, : object 'show_data' not found</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="ot">NA</span>, <span class="ot">NA</span>), <span class="dt">pch=</span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="st">&quot;*&quot;</span>,<span class="st">&quot;*&quot;</span> ), <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>),
       <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;real counts&quot;</span>,<span class="st">&quot;bunchr cf&quot;</span>, <span class="st">&quot;bunch_count cf&quot;</span>))</code></pre></div>
<pre><code>## Error in strwidth(legend, units = &quot;user&quot;, cex = cex, font = text.font): plot.new has not been called yet</code></pre>
<p><em>sim_data</em>.csv, <em>compare_results.csv</em> and <em>show_data.csv</em> are available in the <em>extdata</em> folder of the installation.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Kleven, H J (2016). <em>“Bunching”</em>, Annual Review of Economics, 8(1).<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Saez, E. (2010). <em>“Do taxpayers bunch at kink points?”</em><a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Chetty, R., Friedman, J., Olsen, T., Pistaferri, L. (2011). <em>“Adjustment Costs, Firm Responses, and Micro vs. Macro Labor Supply Elasticities: Evidence from Danish Tax Records”</em>, Quarterly Journal of Economics, 126(2).<a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>Kleven, H.J., Waseem, M., <em>“Using notches to uncover optimization frictions and structural elasticities: Theory and evidence from Pakistan”</em>, The Quarterly Journal of Economics, 128(2)<a href="#fnref4">↩</a></p></li>
</ol>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
